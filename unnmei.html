<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>é‹å‘½ã®å·¦å³</title>

<style>
body{
  margin:0;
  font-family: "Hiragino Mincho ProN", serif;
  text-align:center;
  background: linear-gradient(135deg,#eeeeee,#cccccc);
}

/* ç®¡ç†äººãƒœã‚¿ãƒ³ */
#adminBtn{
  position:fixed;
  top:20px;
  right:20px;
  padding:8px 18px;
  background:black;
  color:white;
  border:none;
  cursor:pointer;
}

/* é¸æŠãƒœã‚¿ãƒ³ */
.choice{
  display:inline-block;
  padding:50px 120px;
  margin:80px;
  font-size:32px;
  border:4px solid #333;
  cursor:pointer;
  background:white;
  transition:0.3s;
}

.choice:hover{
  transform:scale(1.1);
  background:#fff8dc;
}

/* çµæœ */
#resultArea{
  display:none;
  margin-top:80px;
  font-size:45px;
}

/* çµå©šç‰¹åˆ¥æ¼”å‡º */
.marriage{
  color:gold;
  font-size:55px;
  text-shadow:0 0 20px gold;
  animation:glow 1s infinite alternate;
}

@keyframes glow{
  from{ text-shadow:0 0 10px gold; }
  to{ text-shadow:0 0 40px orange; }
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«å…±é€š */
.modal{
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.6);
  justify-content:center;
  align-items:center;
}

.modalContent{
  background:#ddd;
  padding:40px;
  text-align:center;
}

#history{
  max-height:400px;
  overflow-y:auto;
  margin-top:20px;
  text-align:left;
}
</style>
</head>

<body>

<button id="adminBtn">ç®¡ç†äºº</button>

<h1>é‹å‘½ã®å·¦å³</h1>

<div id="choices">
  <div class="choice" onclick="draw()">å·¦</div>
  <div class="choice" onclick="draw()">å³</div>
</div>

<div id="resultArea"></div>

<!-- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="passwordModal" class="modal">
  <div class="modalContent">
    <h2>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›</h2>
    <input type="password" id="adminPass">
    <br><br>
    <button onclick="checkPass()">OK</button>
  </div>
</div>

<!-- ã‚¨ãƒ©ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="errorModal" class="modal">
  <div class="modalContent">
    <h3>é•ã„ã¾ã™</h3>
    <button onclick="closeError()">OK</button>
  </div>
</div>

<!-- ç®¡ç†äººç”»é¢ -->
<div id="adminModal" class="modal">
  <div class="modalContent" style="width:80%;">
    <h2>ç®¡ç†äººç”»é¢ï¼ˆå±¥æ­´ï¼‰</h2>
    <div id="history"></div>
    <br>
    <button onclick="closeAdmin()">é–‰ã˜ã‚‹</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-analytics.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBdE0HjsMvv_j91RV6CeM59QLm1PPkUPbs",
  authDomain: "akaina-33a5c.firebaseapp.com",
  projectId: "akaina-33a5c",
  storageBucket: "akaina-33a5c.firebasestorage.app",
  messagingSenderId: "735800003066",
  appId: "1:735800003066:web:f96fd1c07ee6e82ca17c43",
  measurementId: "G-JRH4K0TP5Z"
};

const app = initializeApp(firebaseConfig);
getAnalytics(app);
const db = getDatabase(app);

const resultsRef = ref(db, "results");

window.draw = function(){
  const resultArea = document.getElementById("resultArea");
  const choices = document.getElementById("choices");
  choices.style.display="none";

  const result = Math.random() < 0.5 ? "çµå©š" : "çµå©šãŠé ã‘";

  const now = new Date();
  const time =
    now.getFullYear()+"å¹´"+
    (now.getMonth()+1)+"æœˆ"+
    now.getDate()+"æ—¥ "+
    now.getHours()+"æ™‚"+
    now.getMinutes()+"åˆ†"+
    now.getSeconds()+"ç§’ ("+
    ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][now.getDay()]+")";

  push(resultsRef,{
    result:result,
    time:time
  });

  resultArea.style.display="block";

  if(result==="çµå©š"){
    resultArea.innerHTML = "<div class='marriage'>ğŸ‰ çµå©š ğŸ‰</div>";
  }else{
    resultArea.innerHTML = "çµå©šãŠé ã‘";
  }
};

/* ç®¡ç†äºº */
document.getElementById("adminBtn").onclick=function(){
  document.getElementById("passwordModal").style.display="flex";
};

window.checkPass=function(){
  const pass=document.getElementById("adminPass").value;
  if(pass==="011289"){
    document.getElementById("passwordModal").style.display="none";
    openAdmin();
  }else{
    document.getElementById("passwordModal").style.display="none";
    document.getElementById("errorModal").style.display="flex";
  }
};

window.closeError=function(){
  document.getElementById("errorModal").style.display="none";
};

function openAdmin(){
  document.getElementById("adminModal").style.display="flex";

  const historyDiv=document.getElementById("history");
  historyDiv.innerHTML="";

  onValue(resultsRef,(snapshot)=>{
    historyDiv.innerHTML="";
    snapshot.forEach((child)=>{
      const data=child.val();
      historyDiv.innerHTML +=
        "<div>"+data.time+" â†’ "+data.result+"</div>";
    });
  });
}

window.closeAdmin=function(){
  document.getElementById("adminModal").style.display="none";
};
</script>

</body>
</html>