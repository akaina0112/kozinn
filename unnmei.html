<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>é‹å‘½ã®å·¦å³</title>
<style>
body {
  font-family: sans-serif;
  text-align: center;
  margin-top: 80px;
}
.choice {
  display: inline-block;
  padding: 40px 80px;
  margin: 40px;
  font-size: 28px;
  border: 3px solid black;
  cursor: pointer;
  background: #f5f5f5;
}
#resultArea {
  display: none;
  margin-top: 40px;
  font-size: 30px;
}
#adminArea {
  display: none;
  margin-top: 30px;
}
button {
  padding: 8px 20px;
  font-size: 16px;
}
</style>
</head>
<body>

<h2>ğŸ”¥ é‹å‘½ã®äºŒæŠ</h2>

<div id="choices"></div>

<div id="resultArea">
  <h3>ğŸ‰ ã‚ãªãŸã®çµæœ</h3>
  <p id="resultText"></p>
</div>

<hr style="margin-top:60px">

<button onclick="showAdmin()">ç®¡ç†äºº</button>

<div id="adminArea">
  <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
  <button onclick="checkPassword()">ç¢ºèª</button>
  <div id="allResults"></div>
</div>

<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyBdE0HjsMvv_j91RV6CeM59QLm1PPkUPbs",
    authDomain: "akaina-33a5c.firebaseapp.com",
    projectId: "akaina-33a5c",
    storageBucket: "akaina-33a5c.firebasestorage.app",
    messagingSenderId: "735800003066",
    appId: "1:735800003066:web:f96fd1c07ee6e82ca17c43",
    measurementId: "G-JRH4K0TP5Z"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);

let results = ["çµå©š", "çµå©šãŠé ã‘"];
results.sort(() => Math.random() - 0.5);

const labels = ["å·¦", "å³"];
const choicesDiv = document.getElementById("choices");

labels.forEach((label, index) => {
  const div = document.createElement("div");
  div.className = "choice";
  div.textContent = label;
  div.onclick = () => select(results[index]);
  choicesDiv.appendChild(div);
});

function formatDate(date) {
  const days = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"];
  return `${date.getFullYear()}/` +
         `${String(date.getMonth()+1).padStart(2,"0")}/` +
         `${String(date.getDate()).padStart(2,"0")} ` +
         `${String(date.getHours()).padStart(2,"0")}:` +
         `${String(date.getMinutes()).padStart(2,"0")}:` +
         `${String(date.getSeconds()).padStart(2,"0")}ï¼ˆ${days[date.getDay()]}ï¼‰`;
}

function select(result) {
  document.getElementById("choices").style.display = "none";
  document.getElementById("resultArea").style.display = "block";
  document.getElementById("resultText").textContent = result;

  const record = {
    result: result,
    time: formatDate(new Date())
  };

  push(ref(db, "history"), record);
}

window.showAdmin = function() {
  document.getElementById("adminArea").style.display = "block";
}

window.checkPassword = function() {
  const input = document.getElementById("password").value;
  if (input !== PASSWORD) {
    alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
    return;
  }

  onValue(ref(db, "history"), (snapshot) => {
    const data = snapshot.val();
    if (!data) {
      document.getElementById("allResults").innerHTML = "å±¥æ­´ãªã—";
      return;
    }

    const list = Object.values(data);
    document.getElementById("allResults").innerHTML =
      "<h3>å…¨å±¥æ­´</h3>" +
      list.map((r,i) =>
        `${i+1}. ${r.result} - ${r.time}`
      ).join("<br>");
  });
}
</script>

</body>
</html>