<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>リアルタイム時計＋年齢一覧＋桜背景</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Noto Sans JP', sans-serif;
      text-align: center;
      margin-top: 60px;
      font-size: 1.2em;
      transition: background-image 1s ease;
      background-size: cover;
    }

    #clock {
      font-weight: bold;
      font-size: 2.2em;
      margin-bottom: 20px;
    }

    #ageList {
      margin-top: 20px;
    }

    #dateList {
      margin-top: 30px;
    }

    input, button {
      font-size: 1em;
      margin: 5px;
      padding: 5px;
    }

    .sakura {
      background-image: url('https://upload.wikimedia.org/wikipedia/commons/6/6b/Sakura_tree_in_full_bloom.jpg');
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <h1>現在の時刻</h1>
  <div id="clock">読み込み中...</div>

  <div id="ageList">
    <h2>登録された年齢</h2>
    <input type="text" id="nameInput" placeholder="名前">
    <input type="text" id="birthInput" placeholder="YYYY/MM/DD">
    <button onclick="addPerson()">追加</button>
    <ul id="peopleList"></ul>
  </div>

  <div id="dateList">
    <h2>背景を桜にしたい日（MM/DD）</h2>
    <input type="text" id="dateInput" placeholder="例: 04/01">
    <button onclick="addSpecialDate()">追加</button>
    <ul id="savedDates"></ul>
  </div>

  <script>
    function loadPeople() {
      return JSON.parse(localStorage.getItem('people') || '[]');
    }

    function savePeople(people) {
      localStorage.setItem('people', JSON.stringify(people));
    }

    function addPerson() {
      const name = document.getElementById('nameInput').value.trim();
      const birth = document.getElementById('birthInput').value.trim();
      if (!name || !/^\d{4}\/\d{2}\/\d{2}$/.test(birth)) {
        alert("名前と生年月日（YYYY/MM/DD）を正しく入力してください。");
        return;
      }
      const people = loadPeople();
      people.push({ name, birth });
      savePeople(people);
      renderPeople();
      document.getElementById('nameInput').value = '';
      document.getElementById('birthInput').value = '';
    }

    function calculateAge(birthStr, now) {
      const [by, bm, bd] = birthStr.split('/').map(Number);
      let age = now.getFullYear() - by;
      const hasBirthdayPassed =
        now.getMonth() + 1 > bm || (now.getMonth() + 1 === bm && now.getDate() >= bd);
      if (!hasBirthdayPassed) age -= 1;
      return age;
    }

    function renderPeople() {
      const list = document.getElementById('peopleList');
      const now = new Date();
      const people = loadPeople();
      list.innerHTML = '';
      people.forEach((person, index) => {
        const li = document.createElement('li');
        const age = calculateAge(person.birth, now);
        li.textContent = `${person.name}：${age}歳`;

        const del = document.createElement('button');
        del.textContent = '削除';
        del.onclick = () => {
          const newPeople = [...people];
          newPeople.splice(index, 1);
          savePeople(newPeople);
          renderPeople();
        };

        li.appendChild(del);
        list.appendChild(li);
      });
    }

    function loadSpecialDates() {
      return JSON.parse(localStorage.getItem('specialDates') || '[]');
    }

    function saveSpecialDates(dates) {
      localStorage.setItem('specialDates', JSON.stringify(dates));
    }

    function addSpecialDate() {
      const input = document.getElementById('dateInput');
      const value = input.value.trim();
      if (/^\d{2}\/\d{2}$/.test(value)) {
        let dates = loadSpecialDates();
        if (!dates.includes(value)) {
          dates.push(value);
          saveSpecialDates(dates);
          renderDates();
        }
        input.value = '';
      } else {
        alert('日付は MM/DD 形式で入力してください。例: 04/01');
      }
    }

    function renderDates() {
      const dates = loadSpecialDates();
      const list = document.getElementById('savedDates');
      list.innerHTML = '';
      dates.forEach((date, index) => {
        const li = document.createElement('li');
        li.textContent = date + ' ';
        const del = document.createElement('button');
        del.textContent = '削除';
        del.onclick = () => {
          const newDates = [...dates];
          newDates.splice(index, 1);
          saveSpecialDates(newDates);
          renderDates();
        };
        li.appendChild(del);
        list.appendChild(li);
      });
    }

    function updateClock() {
      const now = new Date();
      const days = ['日', '月', '火', '水', '木', '金', '土'];
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const date = String(now.getDate()).padStart(2, '0');
      const day = days[now.getDay()];
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');

      const timeString = `${year}/${month}/${date}(${day}) ${hours}:${minutes}:${seconds}`;
      document.getElementById('clock').textContent = timeString;

      // 桜背景
      const today = `${month}/${date}`;
      const specialDates = loadSpecialDates();
      document.body.classList.toggle('sakura', specialDates.includes(today));

      // 年齢再描画（毎秒更新）
      renderPeople();
    }

    // 初期化
    renderPeople();
    renderDates();
    updateClock();
    setInterval(updateClock, 1000);
  </script>
</body>
</html>